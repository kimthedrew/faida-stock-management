{% extends "base.html" %}
{% block content %}
<div class="container">
  <!-- Tabs / Nav would go here if you want them -->
  
  <!-- === RECEIPT TAB === -->
  <div class="tab-content active" id="receipt-content">
    <div class="receipt-container" id="receipt">
      <div class="receipt-header">
        <h2>RetailPro Store</h2>
        <p>123 Main Street, Nairobi, Kenya</p>
        <p>Tel: +254 700 123 456</p>
      </div>
      
      <div class="receipt-details">
        <div class="detail-row">
          <span class="detail-label">Receipt #:</span>
          <span>RCPT-{{ sale.id }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Date:</span>
          <span>{{ sale.date.strftime('%Y-%m-%d %H:%M') }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Cashier:</span>
          <span>{{ sale.cashier_name }}</span>
        </div>
      </div>
      
      <div class="receipt-items">
        <div class="items-header">
          <span>Item</span><span>Qty</span><span>Price</span><span>Total</span>
        </div>
        {% for item in sale.items %}
        <div class="item-row">
          <span>{{ item.stock_item.name }}{% if item.stock_item.size %} ({{ item.stock_item.size }}){% endif %}</span>
          <span>{{ item.quantity }}</span>
          <span>KES {{ '%.2f'|format(item.price) }}</span>
          <span>KES {{ '%.2f'|format(item.price * item.quantity) }}</span>
        </div>
        {% endfor %}
      </div>
      
      <div class="receipt-total">
        <strong>Total: <span>KES {{ '%.2f'|format(sale.total_amount) }}</span></strong>
      </div>
      
      <div class="receipt-details">
        <div class="detail-row">
          <span class="detail-label">Payment Method:</span>
          <span>{{ sale.payment_method|upper }}</span>
        </div>
        {% if sale.payment_method=='mpesa' and sale.mpesa_code %}
        <div class="detail-row">
          <span class="detail-label">M-PESA Code:</span>
          <span>{{ sale.mpesa_code }}</span>
        </div>
        {% endif %}
      </div>
      
      <div class="receipt-footer">
        <p>Thank you for shopping with us!</p>
        <p>Items can be exchanged within 14 days with original receipt</p>
      </div>
    </div>
    
    <div class="action-buttons">
      <button class="btn btn-print" onclick="window.print()">
        <i class="fas fa-print"></i> Print Receipt
      </button>
      <button class="btn btn-download" id="download-pdf">
        <i class="fas fa-download"></i> Download Receipt
      </button>
      <a href="{{ url_for('pos') }}" class="btn btn-new-sale">
        <i class="fas fa-cash-register"></i> New Sale
      </a>
    </div>
  </div>
  
  <!-- === CHECKOUT TAB === -->
  <div class="tab-content" id="checkout-content">
    <!-- same pattern as above, just change titles/text -->
  </div>
</div>
{% endblock %}

{% block scripts %}
  <!-- html2pdf.js (already included in base or reâ€‘include here) -->
  <script>
    document.getElementById('download-pdf').addEventListener('click', () => {
      const element = document.getElementById('receipt');
      const saleId = "{{ sale.id }}";
      html2pdf().set({
        margin: 10,
        filename: 'receipt-RCPT-' + saleId + '.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a5', orientation: 'portrait' }
      }).from(element).save();
    });
  </script>
{% endblock %}
